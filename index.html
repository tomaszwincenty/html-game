<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Happy Mrs. Chicken</title>
  <style>
    * { margin: 0; padding: 0; }
    html, body { width: 100%; height: 100%; }
    canvas { display: block; }
    canvas {
    background: #3AC1FB;
  }
  </style>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
  window.addEventListener('resize', resizeCanvas, false);
  const canvas = document.getElementById('canvas');
  const context = canvas.getContext('2d');
  
  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resizeCanvas();

  const config = {
    inintialCoordinates: [ 
      canvas.width/2,
      canvas.height/2,
  ],
    spawningSpeed: 3,
    incubationTime: 3,
  }

  const state = {
    actionsCounter: 0,
    chickens: [],
    eggs: [],
  }

  class Egg {
    constructor(x, y, id) {
      this.x = x;
      this.y = y;
      this.id = id;
      this.incubationStage = 0;
    }
    incubate() {
      if (this.incubationStage === config.incubationTime) {
        spawnChicken(this.x, this.y);
        this.delete();
        return;
      }
      this.incubationStage++;
      console.log(this.incubationStage);
      setTimeout(() => this.incubate(), 2000);
    }
    delete() {
      state.eggs[this.id] = undefined;
    }
    draw() {
      // var img = new Image();
      // img.onload = () => {
      //   const width = 100;
      //   const height = 100;
      //   context.drawImage(img, this.x, this.y, width, height);
      // }
      // img.src = "egg.svg";
      context.beginPath();
      context.arc(this.x, this.y, 50, 0, Math.PI*2);
      context.fillStyle = "#0095DD";
      // context.font = "30px Arial";
      // context.fillText(this.incubationStage, 10, 50); 
      context.fill();
      context.closePath();
    }
  }

  class Chicken {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.eggTimer = 0;
    }
    draw() {
      var img = new Image();
      img.onload = () => {
        const width = 100;
        const height = 100;
        context.drawImage(img, this.x, this.y, width, height);
      }
      img.src = "chicken.svg";
    }
    move(dx, dy) {
      const randomSign = () => Math.sign(Math.random()-0.5);
      this.x = this.x + randomSign()*dx;
      this.y = this.y + randomSign()*dy;
      this.eggTimer++;
    }
    layEgg () {
      if (this.eggTimer === config.spawningSpeed) {
        const newEgg = new Egg(this.x, this.y, state.eggs.length);
        newEgg.incubate();
        state.eggs.push(newEgg);
        this.eggTimer = 0;
      }
    }
  }

  function spawnChicken(x, y) {
    const newChicken = new Chicken(x, y);
    state.chickens.push(newChicken);
  }

  function action() {
    const { spawningSpeed } = config;
    state.chickens.forEach((chicken) => chicken.move(50, 50));
    state.chickens.forEach((chicken) => chicken.layEgg());
    state.actionsCounter++;
  }

  function draw() {
    context.clearRect(0, 0, canvas.width, canvas.height);
    state.chickens.forEach((chicken) => chicken.draw());
    state.eggs.forEach((egg) => { if(egg) { egg.draw(); }});
    // requestAnimationFrame(draw);
  }

  spawnChicken(...config.inintialCoordinates);
  setInterval(draw, 500);
  // draw();
  document.addEventListener('keydown', action, false);

</script>

</body>
</html>